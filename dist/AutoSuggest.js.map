{"version":3,"file":"AutoSuggest.js","sources":["../src/Utilities.js","../src/SuggestionList.js","../src/SuggestionDropdown.js","../src/AutoSuggest.js"],"sourcesContent":["export const ensure = (context, object, keys) => {\r\n    [].concat(keys).forEach(key => {\r\n        if (typeof object[key] === 'undefined') {\r\n            throw new Error(`AutoSuggest: Missing required parameter, ${context}.${key}`);\r\n        }\r\n    });\r\n};\r\nexport const ensureType = (context, object, key, type) => {\r\n    [].concat(object[key]).forEach(value => {\r\n        if (typeof value !== type) {\r\n            throw new TypeError(`AutoSuggest: Invalid Type for ${context}.${key}, expected ${type}`);\r\n        }\r\n    });\r\n};\r\n\r\nexport const cloneStyle = (element1, element2) => {\r\n    const allStyles = window.getComputedStyle(element1);\r\n    for (let style in allStyles) {\r\n        if (allStyles.hasOwnProperty(style)) {\r\n            element2.style.setProperty(style, allStyles[style]);\r\n        }\r\n    }\r\n};\r\n\r\nexport const getComputedStyle = (element, style) =>\r\n    window.getComputedStyle(element).getPropertyValue(style);\r\n\r\nexport const getGlobalOffset = $0 => {\r\n    let node = $0, top = 0, left = 0;\r\n\r\n    do {\r\n        left += node.offsetLeft;\r\n        top += node.offsetTop;\r\n    } while (node = node.offsetParent);\r\n\r\n    return {left, top};\r\n};\r\n\r\nexport const getScrollLeftForInput = input => {\r\n    if (input.createTextRange) {\r\n        const range = input.createTextRange();\r\n        const inputStyle = window.getComputedStyle(input);\r\n        const paddingLeft = parseFloat(inputStyle.paddingLeft);\r\n        const rangeRect = range.getBoundingClientRect();\r\n        return input.getBoundingClientRect().left + input.clientLeft + paddingLeft - rangeRect.left;\r\n    } else {\r\n        return input.scrollLeft;\r\n    }\r\n};\r\n\r\nexport const getCursorPosition = input => {\r\n    let position = 0;\r\n\r\n    if (typeof input.selectionDirection !== 'undefined') {\r\n        position = input.selectionDirection === 'backward' ? input.selectionStart : input.selectionEnd;\r\n    } else if (document.selection) {\r\n        input.focus();\r\n        const selection = document.selection.createRange();\r\n        selection.moveStart('character', - input.value.length);\r\n        position = selection.text.length;\r\n    }\r\n\r\n    return position;\r\n};\r\n\r\nexport const getContainerTextNode = () => {\r\n    const selection = window.getSelection();\r\n    let cursorPosition = selection.focusOffset;\r\n    let containerTextNode = selection.focusNode;\r\n\r\n    if (containerTextNode.nodeType !== containerTextNode.TEXT_NODE) {\r\n        containerTextNode = containerTextNode.childNodes[cursorPosition];\r\n        while (containerTextNode && containerTextNode.nodeType !== containerTextNode.TEXT_NODE) {\r\n            containerTextNode = containerTextNode.firstChild;\r\n        }\r\n\r\n        cursorPosition = 0;\r\n    }\r\n\r\n    return { cursorPosition, containerTextNode };\r\n}\r\n\r\nexport const makeAsyncQueueRunner = () => {\r\n    let i = 0;\r\n    const queue = [];\r\n\r\n    return (f, j) => {\r\n        queue[j - i] = f;\r\n        while (queue[0]) ++i, queue.shift()();\r\n    };\r\n};\r\n\r\nexport const data = (element, key, value) => {\r\n    key = 'autosuggest_' + key;\r\n    if (typeof value !== 'undefined') {\r\n        element.dataset[key] = JSON.stringify(value);\r\n    } else {\r\n        value = element.dataset[key];\r\n        return typeof value !== 'undefined' ? JSON.parse(element.dataset[key]) : value;\r\n    }\r\n};\r\n\r\nexport const createNode = html => {\r\n    var div = document.createElement('div');\r\n    div.innerHTML = html.trim();\r\n    return div.firstChild; \r\n};\r\n","import { ensure, ensureType } from './Utilities';\r\n\r\nfunction validateSuggestions (suggestions) {\r\n    return [].concat(suggestions).map(suggestion => {\r\n        const type = typeof suggestion;\r\n        if (type === 'string') {\r\n            suggestion = {\r\n                on: [suggestion],\r\n                show: suggestion,\r\n                use: suggestion,\r\n                focus: [0, 0]\r\n            };\r\n        } else if (type === 'object') {\r\n            try {\r\n                ensure('Suggestion', suggestion, 'value');\r\n                ensureType('Suggestion', suggestion, 'value', 'string');\r\n            } catch (e1) {\r\n                if (e1 instanceof TypeError)  throw e1;\r\n\r\n                try {\r\n                    ensure('Suggestion', suggestion, ['on', 'show', 'use']);\r\n                } catch(e2) {\r\n                    if (suggestion.on || suggestion.show || suggestion.use) {\r\n                        throw e2;\r\n                    } else {\r\n                        throw e1;\r\n                    }\r\n                }\r\n\r\n                ensureType('Suggestion', suggestion, 'on', 'string');\r\n                ensureType('Suggestion', suggestion, 'use', 'string');\r\n                ensureType('Suggestion', suggestion, 'show', 'string');\r\n            }\r\n\r\n            suggestion.show = suggestion.show || suggestion.value;\r\n            suggestion.use = suggestion.use || suggestion.value;\r\n            suggestion.on = [suggestion.show].concat(suggestion.on || suggestion.value);\r\n\r\n            suggestion.focus = suggestion.focus || [0, 0];\r\n            if (suggestion.focus.constructor !== Array) {\r\n                suggestion.focus = [suggestion.focus, suggestion.focus];\r\n            }\r\n        }\r\n\r\n        return suggestion;\r\n    });\r\n}\r\n\r\nfunction SuggestionList(options) {\r\n    // validate options\r\n    if (options && !options.values) {\r\n        options = {\r\n            values: options\r\n        };\r\n    }\r\n\r\n    try {\r\n        ensure('SuggestionList', options, 'trigger');\r\n        ensureType('Suggestion', options, 'trigger', 'string');\r\n    } catch (e) {\r\n        if (e instanceof TypeError) throw e;\r\n    }\r\n\r\n    ensure('SuggestionList', options, 'values');\r\n    options.caseSensitive = Boolean(options.caseSensitive);\r\n\r\n    if (typeof options.values === 'function') {\r\n        this.getSuggestions = (keyword, callback) => {\r\n            options.values(keyword, values => callback(validateSuggestions(values)));\r\n        };\r\n    } else if (options.values.constructor === Array || typeof options.values === 'string') {\r\n        options.values = validateSuggestions(options.values);\r\n        this.getSuggestions = (keyword, callback) => {\r\n            const matcher = new RegExp('^' + keyword, !options.caseSensitive ? 'i' : '');\r\n            callback (\r\n                options.values.filter(value => {\r\n                    let matchFound = false;\r\n                    for (let i = 0; i < value.on.length; i++) {\r\n                        if (matchFound = matcher.test(value.on[i])) {\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    return matchFound;\r\n                })\r\n            );\r\n        };\r\n    }\r\n\r\n    this.trigger = options.trigger;\r\n    if (this.trigger) {\r\n        const escapedTrigger = `\\\\${this.trigger.split('').join('\\\\')}`;\r\n        this.regex = new RegExp(`(?:^|[^${escapedTrigger}]+?)${escapedTrigger}(\\\\S*)$`);\r\n    } else {\r\n        this.regex = new RegExp('(?:^|\\\\W+)(\\\\w+)$');\r\n    }\r\n}\r\n\r\nSuggestionList.prototype.getMatch = function (value) {\r\n    return value.match(this.regex)[1];\r\n};\r\n\r\nexport default SuggestionList;\r\n","import { data, createNode } from './Utilities';\r\n\r\nclass SuggestionDropdown {\r\n    constructor() {\r\n        this.width = 0;\r\n        this.isEmpty = true;\r\n        this.isActive = false;\r\n\r\n        this.dropdownContent = document.createElement('ul');\r\n        this.dropdownContent.className = 'dropdown-menu dropdown-menu-left';\r\n\r\n        this.dropdown = document.createElement('div');\r\n        this.dropdown.className = 'dropdown open';\r\n        this.dropdown.style.position = 'absolute';\r\n\r\n        this.hide();\r\n        this.dropdown.appendChild(this.dropdownContent);\r\n        document.body.appendChild(this.dropdown);\r\n    }\r\n\r\n    show(position) {\r\n        if (position) {\r\n            this.dropdown.style.left = `${position.left}px`;\r\n            this.dropdown.style.top = `${position.top}px`;\r\n\r\n            if ((position.left + this.width) > document.body.offsetWidth) {\r\n                this.dropdownContent.classList.remove('dropdown-menu-left');\r\n                this.dropdownContent.classList.add('dropdown-menu-right');\r\n            } else {\r\n                this.dropdownContent.classList.remove('dropdown-menu-right');\r\n                this.dropdownContent.classList.add('dropdown-menu-left');\r\n            }\r\n        }\r\n\r\n        const activeElement = this.getActive();\r\n        activeElement && activeElement.classList.remove('active');\r\n        this.dropdownContent.firstElementChild.classList.add('active');\r\n\r\n        this.dropdown.style.display = 'block';\r\n        this.isActive = true;\r\n    }\r\n\r\n    hide() {\r\n        this.dropdown.style.display = 'none';\r\n        this.isActive = false;\r\n    }\r\n\r\n    empty() {\r\n        this.dropdownContent.innerHTML = '';\r\n        this.isEmpty = true;\r\n    }\r\n\r\n    fill(suggestions, onSet) {\r\n        suggestions.forEach(suggestion => {\r\n            const dropdownLink = createNode(`<li><a>${suggestion.show}</a></li>`);\r\n            this.dropdownContent.append(dropdownLink);\r\n            data(dropdownLink, 'suggestion', suggestion);\r\n\r\n            dropdownLink.addEventListener('mouseenter', () => {\r\n                this.getActive().classList.remove('active');\r\n                dropdownLink.classList.add('active');\r\n            });\r\n\r\n            dropdownLink.addEventListener('mousedown', (e) => {\r\n                onSet(suggestion);\r\n                this.hide();\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            });\r\n        });\r\n\r\n        // Calculate width\r\n        if (!this.isActive) {\r\n            this.show();\r\n        }\r\n\r\n        this.width = this.dropdownContent.offsetWidth;\r\n\r\n        if (!this.isActive) {\r\n            this.hide();\r\n        }\r\n\r\n        this.isEmpty = false;\r\n    }\r\n\r\n    getActive() {\r\n        const activeLinks = Array.prototype.slice.call(this.dropdownContent.querySelectorAll('li.active'), 0);\r\n        while (activeLinks[1]) {\r\n            activeLinks.pop().classList.remove('active');\r\n        }\r\n\r\n        return activeLinks[0];\r\n    }\r\n\r\n    getValue(element) {\r\n        return data((element || this.getActive()), 'suggestion');\r\n    }\r\n\r\n    selectNext() {\r\n        const activeLink = this.getActive();\r\n        const nextLink = activeLink.nextElementSibling || this.dropdownContent.firstElementChild;\r\n\r\n        activeLink.classList.remove('active');\r\n        nextLink.classList.add('active');\r\n    }\r\n\r\n    selectPrev() {\r\n        const activeLink = this.getActive();\r\n        const prevLink = activeLink.previousElementSibling || this.dropdownContent.lastElementChild;\r\n\r\n        activeLink.classList.remove('active');\r\n        prevLink.classList.add('active');\r\n    }\r\n}\r\n\r\nexport default SuggestionDropdown;\r\n","import {\r\n    data, cloneStyle,\r\n    getGlobalOffset,\r\n    getCursorPosition,\r\n    getScrollLeftForInput,\r\n    makeAsyncQueueRunner,\r\n    getContainerTextNode,\r\n    getComputedStyle\r\n} from './Utilities';\r\n\r\nimport SuggestionList from './SuggestionList';\r\nimport SuggestionDropdown from './SuggestionDropdown';\r\n\r\nfunction splitValue(originalValue, cursorPosition, trigger) {\r\n    const value = originalValue.slice(0, cursorPosition);\r\n    let textAfterTrigger = value.split(trigger || /\\W/).pop();\r\n    const textUptoTrigger = textAfterTrigger.length ? value.slice(0, 0 - textAfterTrigger.length) : value;\r\n    textAfterTrigger += originalValue.slice(cursorPosition);\r\n    return { textAfterTrigger, textUptoTrigger };\r\n}\r\n\r\n// Invisible character\r\nconst POSITIONER_CHARACTER = \"\\ufeff\";\r\nfunction getCaretPosition(element, trigger) {\r\n    if (data(element, 'isInput')) {\r\n        const cursorPosition = getCursorPosition(element);\r\n        const { textAfterTrigger, textUptoTrigger } = splitValue(element.value, cursorPosition, trigger);\r\n\r\n        // pre to retain special characters\r\n        const clone = document.createElement('pre');\r\n        clone.id = 'autosuggest-positionclone';\r\n\r\n        const positioner = document.createElement('span');\r\n        positioner.appendChild(document.createTextNode(POSITIONER_CHARACTER));\r\n\r\n        clone.appendChild(document.createTextNode(textUptoTrigger.replace(/ /g, '\\u00A0')));\r\n        clone.appendChild(positioner);\r\n        clone.appendChild(document.createTextNode(textAfterTrigger.replace(/ /g, '\\u00A0')));\r\n        cloneStyle(element, clone);\r\n\r\n        const elementPosition = getGlobalOffset(element);\r\n        clone.style.opacity = 0;\r\n        clone.style.position = 'absolute';\r\n        clone.style.top = `${elementPosition.top}px`;\r\n        clone.style.left = `${elementPosition.left}px`;\r\n        document.body.appendChild(clone);\r\n\r\n        // Extra styles for the clone depending on type of input\r\n        if (element.tagName === 'INPUT') {\r\n            clone.style.overflowX = 'auto';\r\n            clone.style.whiteSpace = 'nowrap';\r\n            if (cursorPosition === element.value.length) {\r\n                clone.scrollLeft = clone.scrollWidth - clone.clientWidth;\r\n            } else {\r\n                clone.scrollLeft = Math.min(getScrollLeftForInput(element), clone.scrollWidth - clone.clientWidth);\r\n            }\r\n        } else {\r\n            clone.style.maxWidth = '100%';\r\n            clone.style.whiteSpace = 'pre-wrap';\r\n            clone.scrollTop = element.scrollTop;\r\n            clone.scrollLeft = element.scrollLeft;\r\n        }\r\n\r\n        const caretPosition = getGlobalOffset(positioner);\r\n        caretPosition.left -= clone.scrollLeft;\r\n\r\n        const charHeight = parseFloat(getComputedStyle(positioner, 'line-height'));\r\n        caretPosition.top += charHeight - clone.scrollTop;\r\n\r\n        document.body.removeChild(clone);\r\n        return caretPosition;\r\n    } else {\r\n        const { startContainer, startOffset, endContainer, endOffset } = window.getSelection().getRangeAt(0);\r\n        const { cursorPosition, containerTextNode } = getContainerTextNode();\r\n        const { textAfterTrigger, textUptoTrigger } = splitValue(containerTextNode.nodeValue, cursorPosition, trigger);\r\n\r\n        const parentNode = containerTextNode.parentNode;\r\n        const referenceNode = containerTextNode.nextSibling;\r\n\r\n        const positioner = document.createElement(\"span\");\r\n        positioner.appendChild(document.createTextNode(POSITIONER_CHARACTER));\r\n        parentNode.insertBefore(positioner, referenceNode);\r\n\r\n        if (textAfterTrigger) {\r\n            containerTextNode.nodeValue = textUptoTrigger;\r\n            const remainingTextNode = document.createTextNode(textAfterTrigger);\r\n            parentNode.insertBefore(remainingTextNode, referenceNode);\r\n        }\r\n\r\n        const caretPosition = getGlobalOffset(positioner);\r\n        const charHeight = parseFloat(getComputedStyle(positioner, 'line-height'));\r\n        caretPosition.top += charHeight;\r\n\r\n        // Reset DOM to the state before changes\r\n        parentNode.removeChild(positioner);\r\n        if (textAfterTrigger) {\r\n            parentNode.removeChild(containerTextNode.nextSibling);\r\n            containerTextNode.nodeValue = textUptoTrigger + textAfterTrigger;\r\n        }\r\n\r\n        const selection = window.getSelection().getRangeAt(0);\r\n        selection.setStart(startContainer, startOffset);\r\n        selection.setEnd(endContainer, endOffset);\r\n\r\n        return caretPosition;\r\n    }\r\n}\r\n\r\nconst getModifiedValue = (originalValue, insertText, cursorPosition, trigger) => {\r\n    let value = originalValue.slice(0, cursorPosition);\r\n    const currentValue = value.split(trigger || /\\W/).pop();\r\n    value = value.slice(0, 0 - currentValue.length - (trigger || '').length);\r\n    return value + insertText + originalValue.slice(cursorPosition);\r\n};\r\n\r\nconst getFocusPosition = (originalValue, modifiedValue, cursorPosition, focus) => {\r\n    const cursorStartPosition = modifiedValue.length - (originalValue.length - cursorPosition);\r\n    return [cursorStartPosition + focus[0], cursorStartPosition + focus[1]];\r\n};\r\n\r\nconst setValue = ({ element, trigger, suggestion, onChange }) => {\r\n    const insertText = suggestion.use;\r\n\r\n    if (data(element, 'isInput')) {\r\n        const cursorPosition = getCursorPosition(element);\r\n        const originalValue = element.value;\r\n        const modifiedValue = getModifiedValue(originalValue, insertText, cursorPosition, trigger);\r\n        element.value = modifiedValue;\r\n        element.focus();\r\n\r\n        const focusPostion = getFocusPosition(originalValue, modifiedValue, cursorPosition, suggestion.focus);\r\n        element.setSelectionRange(focusPostion[0], focusPostion[1]);\r\n    } else {\r\n        const { cursorPosition, containerTextNode } = getContainerTextNode();\r\n        if (!containerTextNode) return null;\r\n\r\n        const originalValue = containerTextNode.nodeValue;\r\n        const modifiedValue = getModifiedValue(originalValue, insertText, cursorPosition, trigger);\r\n        containerTextNode.nodeValue = modifiedValue;\r\n\r\n        const focusPostion = getFocusPosition(originalValue, modifiedValue, cursorPosition, suggestion.focus);\r\n        const selection = window.getSelection().getRangeAt(0);\r\n        selection.setStart(containerTextNode, focusPostion[0]);\r\n        selection.setEnd(containerTextNode, focusPostion[1]);\r\n    }\r\n\r\n    onChange(suggestion.use, suggestion);\r\n};\r\n\r\nclass AutoSuggest {\r\n    constructor(options, ...inputs) {\r\n        if (!options) {\r\n            throw new Error(`AutoSuggest: Missing required parameter, options`);\r\n        }\r\n\r\n        this.inputs = [];\r\n        this.dropdown = new SuggestionDropdown();\r\n        this.onChange = options.onChange || Function.prototype;\r\n        this.maxSuggestions = options.maxSuggestions || 10;\r\n\r\n        // validate suggestions\r\n        this.suggestionLists = options.suggestions || [];\r\n        for (let i = 0; i < this.suggestionLists.length; i++) {\r\n            let suggestionList = this.suggestionLists[i];\r\n            if (!(suggestionList instanceof SuggestionList)) {\r\n                if (suggestionList.constructor !== Object) {\r\n                    suggestionList = { values: suggestionList };\r\n                }\r\n\r\n                if (!suggestionList.hasOwnProperty('caseSensitive') && options.hasOwnProperty('caseSensitive')) {\r\n                    suggestionList.caseSensitive = options.caseSensitive;\r\n                }\r\n\r\n                this.suggestionLists[i] = new SuggestionList(suggestionList);\r\n            }\r\n        }\r\n\r\n        events: {\r\n            const self = this;\r\n            let activeSuggestionList = null;\r\n            let handledInKeyDown = false;\r\n\r\n            this.onBlurHandler = function() {\r\n                self.dropdown.hide();\r\n            };\r\n\r\n            this.onKeyDownHandler = function(e) {\r\n                handledInKeyDown = false;\r\n                if (self.dropdown.isActive) {\r\n                    const preventDefaultAction = () => {\r\n                        e.preventDefault();\r\n                        handledInKeyDown = true;\r\n                    };\r\n\r\n                    if (e.keyCode === 13 || e.keyCode === 9) {\r\n                        setValue({\r\n                            element: this,\r\n                            trigger: activeSuggestionList.trigger,\r\n                            suggestion: self.dropdown.getValue(),\r\n                            onChange: self.onChange\r\n                        });\r\n                        self.dropdown.hide();\r\n                        return preventDefaultAction();\r\n                    } else if (e.keyCode === 40) {\r\n                        self.dropdown.selectNext();\r\n                        return preventDefaultAction();\r\n                    } else if (e.keyCode === 38) {\r\n                        self.dropdown.selectPrev();\r\n                        return preventDefaultAction();\r\n                    } else if (e.keyCode === 27) {\r\n                        self.dropdown.hide();\r\n                        return preventDefaultAction();\r\n                    }\r\n                }\r\n            };\r\n\r\n            this.onKeyUpHandler = function(e) {\r\n                if (handledInKeyDown) return;\r\n\r\n                let value;\r\n                if (data(this, 'isInput')) {\r\n                    const cursorPosition = getCursorPosition(this);\r\n                    if ((this.value.charAt(cursorPosition) || '').trim()) {\r\n                        self.dropdown.hide();\r\n                        return;\r\n                    }\r\n\r\n                    value = this.value.slice(0, cursorPosition);\r\n                } else {\r\n                    const { cursorPosition, containerTextNode } = getContainerTextNode();\r\n                    if (!containerTextNode || (containerTextNode.nodeValue.charAt(cursorPosition) || '').trim()) {\r\n                        self.dropdown.hide();\r\n                        return;\r\n                    }\r\n\r\n                    value = containerTextNode.nodeValue.slice(0, cursorPosition);\r\n                }\r\n\r\n                handleDropdown: {\r\n                    let i = 0, triggerMatchFound = false;\r\n                    const execute = makeAsyncQueueRunner();\r\n\r\n                    self.dropdown.empty();\r\n                    for (let suggestionList of self.suggestionLists) {\r\n                        if (suggestionList.regex.test(value)) {\r\n                            triggerMatchFound = true;\r\n\r\n                            (i => {\r\n                                const match = suggestionList.getMatch(value);\r\n                                suggestionList.getSuggestions(match, results => {\r\n                                    execute(() => {\r\n                                        if (self.dropdown.isEmpty) {\r\n                                            if (results.length) {\r\n                                                activeSuggestionList = suggestionList;\r\n                                                self.dropdown.fill(\r\n                                                    results.slice(0, self.maxSuggestions),\r\n                                                    suggestion => {\r\n                                                        setValue({\r\n                                                            element: this,\r\n                                                            trigger: suggestionList.trigger,\r\n                                                            suggestion: suggestion,\r\n                                                            onChange: self.onChange\r\n                                                        });\r\n                                                    }\r\n                                                );\r\n\r\n                                                self.dropdown.show(getCaretPosition(this, suggestionList.trigger));\r\n                                            } else {\r\n                                                self.dropdown.hide();\r\n                                            }\r\n                                        }\r\n                                    }, i);\r\n                                });\r\n                            })(i++);\r\n                        }\r\n                    }\r\n\r\n                    if (!triggerMatchFound) {\r\n                        self.dropdown.hide();\r\n                    }\r\n                }\r\n            };\r\n        }\r\n\r\n        // initialize events on inputs\r\n        this.addInputs(...inputs);\r\n    }\r\n\r\n    addInputs(...args) {\r\n        const inputs = Array.prototype.concat.apply([], args.map(d => d[0] ? Array.prototype.slice.call(d, 0) : d));\r\n\r\n        inputs.forEach(input => {\r\n            // validate element\r\n            if (input.isContentEditable) {\r\n                data(input, 'isInput', false)\r\n            } else if (input.tagName === 'TEXTAREA' || (input.tagName === 'INPUT' && input.type === 'text')) {\r\n                data(input, 'isInput', true)\r\n            } else {\r\n                throw new Error('AutoSuggest: Invalid input: only input[type = text], textarea and contenteditable elements are supported');\r\n            }\r\n\r\n            // init events\r\n            input.addEventListener('blur', this.onBlurHandler);\r\n            input.addEventListener('keyup', this.onKeyUpHandler);\r\n            input.addEventListener('keydown', this.onKeyDownHandler, true);\r\n\r\n            data(input, 'index', this.inputs.push(input) - 1);\r\n        });\r\n    }\r\n\r\n    removeInputs(...args) {\r\n        const inputs = Array.prototype.concat.apply([], args.map(d => d[0] ? Array.prototype.slice.call(d, 0) : d));\r\n\r\n        inputs.forEach(input => {\r\n            const index = data(input, 'index');\r\n            if (!isNaN(index)) {\r\n                this.inputs.splice(index, 1);\r\n\r\n                // destroy events\r\n                input.removeEventListener('blur', this.onBlurHandler);\r\n                input.removeEventListener('keyup', this.onKeyUpHandler);\r\n                input.removeEventListener('keydown', this.onKeyDownHandler, true);\r\n            }\r\n        });\r\n    }\r\n\r\n    destroy() {\r\n        this.removeInputs(this.inputs);\r\n    }\r\n}\r\n\r\nexport default AutoSuggest;\r\n"],"names":["ensure","context","object","keys","concat","forEach","key","Error","ensureType","type","value","TypeError","cloneStyle","element1","element2","allStyles","window","getComputedStyle","style","hasOwnProperty","setProperty","element","getPropertyValue","getGlobalOffset","node","$0","top","left","offsetLeft","offsetTop","offsetParent","getScrollLeftForInput","input","createTextRange","range","inputStyle","paddingLeft","parseFloat","rangeRect","getBoundingClientRect","clientLeft","scrollLeft","getCursorPosition","position","selectionDirection","selectionStart","selectionEnd","document","selection","focus","createRange","moveStart","length","text","getContainerTextNode","getSelection","cursorPosition","focusOffset","containerTextNode","focusNode","nodeType","TEXT_NODE","childNodes","firstChild","makeAsyncQueueRunner","i","queue","f","j","shift","data","dataset","JSON","stringify","parse","createNode","div","createElement","innerHTML","html","trim","validateSuggestions","suggestions","map","suggestion","e1","e2","on","show","use","constructor","Array","SuggestionList","options","values","e","caseSensitive","Boolean","getSuggestions","keyword","callback","matcher","RegExp","filter","matchFound","test","trigger","escapedTrigger","split","join","regex","prototype","getMatch","match","SuggestionDropdown","width","isEmpty","isActive","dropdownContent","className","dropdown","hide","appendChild","body","offsetWidth","classList","remove","add","activeElement","getActive","firstElementChild","display","onSet","dropdownLink","append","addEventListener","preventDefault","stopPropagation","activeLinks","slice","call","querySelectorAll","pop","activeLink","nextLink","nextElementSibling","prevLink","previousElementSibling","lastElementChild","splitValue","originalValue","textAfterTrigger","textUptoTrigger","POSITIONER_CHARACTER","getCaretPosition","clone","id","positioner","createTextNode","replace","elementPosition","opacity","tagName","overflowX","whiteSpace","scrollWidth","clientWidth","Math","min","maxWidth","scrollTop","caretPosition","charHeight","removeChild","getRangeAt","startContainer","startOffset","endContainer","endOffset","nodeValue","parentNode","referenceNode","nextSibling","insertBefore","remainingTextNode","setStart","setEnd","getModifiedValue","insertText","currentValue","getFocusPosition","modifiedValue","cursorStartPosition","setValue","onChange","focusPostion","setSelectionRange","AutoSuggest","inputs","Function","maxSuggestions","suggestionLists","suggestionList","Object","self","activeSuggestionList","handledInKeyDown","onBlurHandler","onKeyDownHandler","preventDefaultAction","keyCode","getValue","selectNext","selectPrev","onKeyUpHandler","charAt","triggerMatchFound","execute","empty","results","fill","addInputs","args","apply","d","isContentEditable","push","index","isNaN","splice","removeEventListener","removeInputs"],"mappings":"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"}