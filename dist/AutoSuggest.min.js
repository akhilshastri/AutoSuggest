!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AutoSuggest=t()}(this,function(){"use strict";function e(e){return[].concat(e).map(function(e){var t=void 0===e?"undefined":o(e);if("string"===t)e={on:[e],show:e,use:e,focus:[0,0]};else if("object"===t){try{s("Suggestion",e,"value"),a("Suggestion",e,"value","string")}catch(t){if(t instanceof TypeError)throw t;try{s("Suggestion",e,["on","show","use"])}catch(n){throw e.on||e.show||e.use?n:t}a("Suggestion",e,"on","string"),a("Suggestion",e,"use","string"),a("Suggestion",e,"show","string")}e.show=e.show||e.value,e.use=e.use||e.value,e.on=[e.show].concat(e.on||e.value),e.focus=e.focus||[0,0],e.focus.constructor!==Array&&(e.focus=[e.focus,e.focus])}return e})}function t(t){t&&!t.values&&(t={values:t});try{s("SuggestionList",t,"trigger"),a("Suggestion",t,"trigger","string")}catch(e){if(e instanceof TypeError)throw e}if(s("SuggestionList",t,"values"),t.caseSensitive=!!t.caseSensitive,"function"==typeof t.values?this.getSuggestions=function(n,o){t.values(n,function(t){return o(e(t))})}:t.values.constructor!==Array&&"string"!=typeof t.values||(t.values=e(t.values),this.getSuggestions=function(e,n){var o=RegExp("^"+e,t.caseSensitive?"":"i");n(t.values.filter(function(e){for(var t=!1,n=0;e.on.length>n&&!(t=o.test(e.on[n]));n++);return t}))}),this.trigger=t.trigger,this.trigger){var n="\\"+this.trigger.split("").join("\\");this.regex=RegExp("(?:^|[^"+n+"]+?)"+n+"(\\S*)$")}else this.regex=RegExp("(?:^|\\W+)(\\w+)$")}function n(e,t,n){var o=e.slice(0,t),i=o.split(n||/\W/).pop(),r=i.length?o.slice(0,0-i.length):o;return i+=e.slice(t),{textAfterTrigger:i,textUptoTrigger:r}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;t.length>n;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function(e,t,n){[].concat(n).forEach(function(n){if(void 0===t[n])throw Error("AutoSuggest: Missing required parameter, "+e+"."+n)})},a=function(e,t,n,i){[].concat(t[n]).forEach(function(t){if((void 0===t?"undefined":o(t))!==i)throw new TypeError("AutoSuggest: Invalid Type for "+e+"."+n+", expected "+i)})},u=function(e,t){var n=window.getComputedStyle(e);for(var o in n)n.hasOwnProperty(o)&&t.style.setProperty(o,n[o])},d=function(e,t){return window.getComputedStyle(e).getPropertyValue(t)},l=function(e){var t=e,n=0,o=0;do{o+=t.offsetLeft,n+=t.offsetTop}while(t=t.offsetParent);return{left:o,top:n}},c=function(e){if(e.createTextRange){var t=e.createTextRange(),n=window.getComputedStyle(e),o=parseFloat(n.paddingLeft),i=t.getBoundingClientRect();return e.getBoundingClientRect().left+e.clientLeft+o-i.left}return e.scrollLeft},p=function(e){var t=0;if(void 0!==e.selectionDirection)t="backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;else if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}return t},f=function(){var e=window.getSelection(),t=e.focusOffset,n=e.focusNode;if(n.nodeType!==n.TEXT_NODE){for(n=n.childNodes[t];n&&n.nodeType!==n.TEXT_NODE;)n=n.firstChild;t=0}return{cursorPosition:t,containerTextNode:n}},g=function(){var e=0,t=[];return function(n,o){for(t[o-e]=n;t[0];)++e,t.shift()()}},h=function(e,t,n){if(t="autosuggest_"+t,void 0===n)return void 0!==(n=e.dataset[t])?JSON.parse(e.dataset[t]):n;e.dataset[t]=JSON.stringify(n)};t.prototype.getMatch=function(e){return e.match(this.regex)[1]};var v=function(){function e(){i(this,e),this.width=0,this.isEmpty=!0,this.isActive=!1,this.dropdownContent=document.createElement("ul"),this.dropdownContent.className="dropdown-menu dropdown-menu-left",this.dropdown=document.createElement("div"),this.dropdown.className="dropdown open",this.dropdown.style.position="absolute",this.hide(),this.dropdown.appendChild(this.dropdownContent),document.body.appendChild(this.dropdown)}return r(e,[{key:"show",value:function(e){e&&(this.dropdown.style.left=e.left+"px",this.dropdown.style.top=e.top+"px",e.left+this.width>document.body.offsetWidth?(this.dropdownContent.classList.remove("dropdown-menu-left"),this.dropdownContent.classList.add("dropdown-menu-right")):(this.dropdownContent.classList.remove("dropdown-menu-right"),this.dropdownContent.classList.add("dropdown-menu-left")));var t=this.getActive();t&&t.classList.remove("active"),this.dropdownContent.firstElementChild.classList.add("active"),this.dropdown.style.display="block",this.isActive=!0}},{key:"hide",value:function(){this.dropdown.style.display="none",this.isActive=!1}},{key:"empty",value:function(){this.dropdownContent.innerHTML="",this.isEmpty=!0}},{key:"fill",value:function(e,t){var n=this;e.forEach(function(e){var o=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}("<li><a>"+e.show+"</a></li>");n.dropdownContent.append(o),h(o,"suggestion",e),o.addEventListener("mouseenter",function(){n.getActive().classList.remove("active"),o.classList.add("active")}),o.addEventListener("mousedown",function(o){t(e),n.hide(),o.preventDefault(),o.stopPropagation()})}),this.isActive||this.show(),this.width=this.dropdownContent.offsetWidth,this.isActive||this.hide(),this.isEmpty=!1}},{key:"getActive",value:function(){for(var e=Array.prototype.slice.call(this.dropdownContent.querySelectorAll("li.active"),0);e[1];)e.pop().classList.remove("active");return e[0]}},{key:"getValue",value:function(e){return h(e||this.getActive(),"suggestion")}},{key:"selectNext",value:function(){var e=this.getActive(),t=e.nextElementSibling||this.dropdownContent.firstElementChild;e.classList.remove("active"),t.classList.add("active")}},{key:"selectPrev",value:function(){var e=this.getActive(),t=e.previousElementSibling||this.dropdownContent.lastElementChild;e.classList.remove("active"),t.classList.add("active")}}]),e}(),y="\ufeff",w=function(e,t,n,o){var i=e.slice(0,n),r=i.split(o||/\W/).pop();return(i=i.slice(0,0-r.length-(o||"").length))+t+e.slice(n)},m=function(e,t,n,o){var i=t.length-(e.length-n);return[i+o[0],i+o[1]]},S=function(e){var t=e.element,n=e.trigger,o=e.suggestion,i=e.onChange,r=o.use;if(h(t,"isInput")){var s=p(t),a=t.value,u=w(a,r,s,n);t.value=u,t.focus();var d=m(a,u,s,o.focus);t.setSelectionRange(d[0],d[1])}else{var l=f(),c=l.cursorPosition,g=l.containerTextNode;if(!g)return null;var v=g.nodeValue,y=w(v,r,c,n);g.nodeValue=y;var S=m(v,y,c,o.focus),C=window.getSelection().getRangeAt(0);C.setStart(g,S[0]),C.setEnd(g,S[1])}i(o.use,o)};return function(){function e(o){if(i(this,e),!o)throw Error("AutoSuggest: Missing required parameter, options");this.inputs=[],this.dropdown=new v,this.onChange=o.onChange||Function.prototype,this.maxSuggestions=o.maxSuggestions||10,this.suggestionLists=o.suggestions||[];for(var r=0;this.suggestionLists.length>r;r++){var s=this.suggestionLists[r];s instanceof t||(s.constructor!==Object&&(s={values:s}),!s.hasOwnProperty("caseSensitive")&&o.hasOwnProperty("caseSensitive")&&(s.caseSensitive=o.caseSensitive),this.suggestionLists[r]=new t(s))}var a=this,w=null,m=!1;this.onBlurHandler=function(){a.dropdown.hide()},this.onKeyDownHandler=function(e){if(m=!1,a.dropdown.isActive){var t=function(){e.preventDefault(),m=!0};if(13===e.keyCode||9===e.keyCode)return S({element:this,trigger:w.trigger,suggestion:a.dropdown.getValue(),onChange:a.onChange}),a.dropdown.hide(),t();if(40===e.keyCode)return a.dropdown.selectNext(),t();if(38===e.keyCode)return a.dropdown.selectPrev(),t();if(27===e.keyCode)return a.dropdown.hide(),t()}},this.onKeyUpHandler=function(e){var t=this;if(!m){var o=void 0;if(h(this,"isInput")){var i=p(this);if((this.value.charAt(i)||"").trim())return void a.dropdown.hide();o=this.value.slice(0,i)}else{var r=f(),s=r.cursorPosition,v=r.containerTextNode;if(!v||(v.nodeValue.charAt(s)||"").trim())return void a.dropdown.hide();o=v.nodeValue.slice(0,s)}!function(){var e=0,i=!1,r=g();a.dropdown.empty();var s=function(s){s.regex.test(o)&&(i=!0,function(e){var i=s.getMatch(o);s.getSuggestions(i,function(o){r(function(){a.dropdown.isEmpty&&(o.length?(w=s,a.dropdown.fill(o.slice(0,a.maxSuggestions),function(e){S({element:t,trigger:s.trigger,suggestion:e,onChange:a.onChange})}),a.dropdown.show(function(e,t){if(h(e,"isInput")){var o=p(e),i=n(e.value,o,t),r=i.textAfterTrigger,s=i.textUptoTrigger,a=document.createElement("pre");a.id="autosuggest-positionclone";var g=document.createElement("span");g.appendChild(document.createTextNode(y)),a.appendChild(document.createTextNode(s.replace(/ /g," "))),a.appendChild(g),a.appendChild(document.createTextNode(r.replace(/ /g," "))),u(e,a);var v=l(e);a.style.opacity=0,a.style.position="absolute",a.style.top=v.top+"px",a.style.left=v.left+"px",document.body.appendChild(a),"INPUT"===e.tagName?(a.style.overflowX="auto",a.style.whiteSpace="nowrap",a.scrollLeft=o===e.value.length?a.scrollWidth-a.clientWidth:Math.min(c(e),a.scrollWidth-a.clientWidth)):(a.style.maxWidth="100%",a.style.whiteSpace="pre-wrap",a.scrollTop=e.scrollTop,a.scrollLeft=e.scrollLeft);var w=l(g);w.left-=a.scrollLeft;var m=parseFloat(d(g,"line-height"));return w.top+=m-a.scrollTop,document.body.removeChild(a),w}var S=window.getSelection().getRangeAt(0),C=S.startContainer,E=S.startOffset,x=S.endContainer,A=S.endOffset,L=f(),T=L.containerTextNode,b=n(T.nodeValue,L.cursorPosition,t),N=b.textAfterTrigger,k=b.textUptoTrigger,P=T.parentNode,I=T.nextSibling,R=document.createElement("span");if(R.appendChild(document.createTextNode(y)),P.insertBefore(R,I),N){T.nodeValue=k;var O=document.createTextNode(N);P.insertBefore(O,I)}var H=l(R),V=parseFloat(d(R,"line-height"));H.top+=V,P.removeChild(R),N&&(P.removeChild(T.nextSibling),T.nodeValue=k+N);var W=window.getSelection().getRangeAt(0);return W.setStart(C,E),W.setEnd(x,A),H}(t,s.trigger))):a.dropdown.hide())},e)})}(e++))},v=!0,m=!1,C=void 0;try{for(var E,x=a.suggestionLists[Symbol.iterator]();!(v=(E=x.next()).done);v=!0){s(E.value)}}catch(e){m=!0,C=e}finally{try{!v&&x.return&&x.return()}finally{if(m)throw C}}i||a.dropdown.hide()}()}};for(var C=arguments.length,E=Array(C>1?C-1:0),x=1;C>x;x++)E[x-1]=arguments[x];this.addInputs.apply(this,E)}return r(e,[{key:"addInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e})).forEach(function(t){if(t.isContentEditable)h(t,"isInput",!1);else{if("TEXTAREA"!==t.tagName&&("INPUT"!==t.tagName||"text"!==t.type))throw Error("AutoSuggest: Invalid input: only input[type = text], textarea and contenteditable elements are supported");h(t,"isInput",!0)}t.addEventListener("blur",e.onBlurHandler),t.addEventListener("keyup",e.onKeyUpHandler),t.addEventListener("keydown",e.onKeyDownHandler,!0),h(t,"index",e.inputs.push(t)-1)})}},{key:"removeInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e})).forEach(function(t){var n=h(t,"index");isNaN(n)||(e.inputs.splice(n,1),t.removeEventListener("blur",e.onBlurHandler),t.removeEventListener("keyup",e.onKeyUpHandler),t.removeEventListener("keydown",e.onKeyDownHandler,!0))})}},{key:"destroy",value:function(){this.removeInputs(this.inputs)}}]),e}()});
