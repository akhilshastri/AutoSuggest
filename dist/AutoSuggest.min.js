!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):t.AutoSuggest=e(t.jQuery)}(this,function(t){"use strict";function e(t,e){return[].concat(t).map(function(t){var n=void 0===t?"undefined":r(t);return"string"===n?(t={show:t,replaceWith:t,cursorPosition:[0,0]},e||(t.on=[t.show])):"object"===n&&(s.ensure("Suggestion",t,["show","replaceWith"]),s.ensureType("Suggestion",t,"show","string"),s.ensureType("Suggestion",t,"replaceWith","string"),t.cursorPosition=t.cursorPosition||[0,0],t.cursorPosition.constructor!==Array&&(t.cursorPosition=[t.cursorPosition,t.cursorPosition]),e||(s.ensure("Suggestion",t,"on"),s.ensureType("Suggestion",t,"on","string"),t.on=[].concat(t.on))),t})}function n(t){t&&!t.suggestions&&(t={suggestions:t}),t=u.extend(!0,{},a,t||{}),s.ensure("SuggestionList",t,"suggestions"),"function"==typeof t.suggestions?this.getSuggestions=function(n,o){t.suggestions(n,function(t){return o(e(t,!0))})}:t.suggestions.constructor!==Array&&"string"!=typeof t.suggestions||(t.suggestions=e(t.suggestions),this.getSuggestions=function(e,n){var o=RegExp(e,t.caseSensitive?"":"i");n(t.suggestions.filter(function(t){for(var e=!1,n=0;t.on.length>n&&!(e=o.test(t.on[n]));n++);return e}))});var n=t.trigger;if(n&&"string"!=typeof n)throw Error("AutoSuggest: Invalid Type, SuggestionList.trigger should be a string");if(n){var o="\\"+n.split("").join("\\");this.regex=RegExp("(?:^|[^"+o+"]+)"+o+"(\\S*)$")}else this.regex=RegExp("(?:^|\\W+)(\\w+)$");this.trigger=n}function o(t,e,n){n.forEach(function(n){void 0!==e[n]&&void 0===t[n]&&(t[n]=e[n])})}t=t&&"default"in t?t.default:t;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s={noop:function(){},noopd:function(t){return t},ensure:function(t,e,n){[].concat(n).forEach(function(n){if(void 0===e[n])throw Error("AutoSuggest: Missing required parameter, "+t+"."+n)})},ensureType:function(t,e,n,o){[].concat(e[n]).forEach(function(e){if((void 0===e?"undefined":i(e))!==o)throw Error("AutoSuggest: Invalid Type for "+t+"."+n+", expected "+o)})},cloneStyle:function(t,e){var n=window.getComputedStyle($(t)[0],null),o={};Array.prototype.forEach.call(n,function(t){o[t]=n.getPropertyValue(t)}),$(e).css(o)},getGlobalOffset:function(t){var e=t,n=0,o=0;do{n+=e.offsetLeft,o+=e.offsetTop}while(e=e.offsetParent);return{left:n,top:o}},getScrollLeftForInput:function(t){if(t.createTextRange){var e=t.createTextRange(),n=window.getComputedStyle(t,void 0),o=parseFloat(n.paddingLeft),i=e.getBoundingClientRect();return t.getBoundingClientRect().left+t.clientLeft+o-i.left}return $(t).scrollLeft()},getCursorPosition:function(t){var e=0;if(void 0!==t.selectionDirection)e="backward"==t.selectionDirection?t.selectionStart:t.selectionEnd;else if(document.selection){t.focus();var n=document.selection.createRange();n.moveStart("character",-t.value.length),e=n.text.length}return e},htmlEncode:function(t){return $("<div/>").text(t).html()}},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=t,a={trigger:null,caseSensitive:!0},l=function(){function t(t,e){for(var n=0;e.length>n;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),d=t,c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.width=0,this.hidden=!0,this.dropdownContent=d('<ul class="dropdown-menu dropdown-menu-left"></ul>'),this.dropdown=d('<div class="dropdown open as-dropdown" style="display:none; position: absolute;"></div>'),d("body").append(this.dropdown.append(this.dropdownContent)),this.hide()}return l(t,[{key:"show",value:function(t){t&&(this.dropdown[0].style.left=t.left+"px",this.dropdown[0].style.top=t.top+"px",t.left+this.width>d("body").width()?this.dropdown.find(".dropdown-menu").removeClass("dropdown-menu-left").addClass("dropdown-menu-right"):this.dropdown.find(".dropdown-menu").removeClass("dropdown-menu-right").addClass("dropdown-menu-left")),this.dropdown.find("li").removeClass("active"),this.dropdown.find("li:first-child").addClass("active"),this.dropdown.show(),this.hidden=!1}},{key:"hide",value:function(){this.dropdown.hide(),this.hidden=!0}},{key:"setWidth",value:function(){this.width=this.dropdownContent.width()}},{key:"fill",value:function(t,e){var n=this;this.dropdownContent.empty(),t.forEach(function(t){var o=d("<li><a>"+t.show+"</a></li>");o.data("as-linkcontent",t),o.mousedown(function(){return e(t),n.hide(),!1}),n.dropdownContent.append(o)}),this.hidden?(this.show(),this.setWidth(),this.hide()):this.setWidth()}},{key:"getValue",value:function(){return this.dropdown.find("li.active").data("as-linkcontent")}},{key:"next",value:function(){var t=this.dropdown.find("li.active"),e=t.next();return t.removeClass("active"),e.length?e.addClass("active"):this.dropdown.find("li:first-child").addClass("active"),this.getValue()}},{key:"prev",value:function(){var t=this.dropdown.find("li.active"),e=t.prev();return t.removeClass("active"),e.length?e.addClass("active"):this.dropdown.find("li:last-child").addClass("active"),this.getValue()}}]),t}(),f=function(){function t(t,e){for(var n=0;e.length>n;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),p=t,g={suggestions:[]},h=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=p.extend(!0,{},g,e||{}),this.isActive=!1,this.activeElement=null,this.activeElementCursorPosition=0,this.activeSuggestionList=null,this.dropdown=new c,this.suggestionLists=[].concat(e.suggestions);for(var s=0;this.suggestionLists.length>s;s++){var r=this.suggestionLists[s];if(!r)throw Error("AutoSuggest: invalid suggestion list passed");r instanceof n||(r.suggestions||(r={suggestions:r}),o(r,e,["caseSensitive","trigger"]),this.suggestionLists[s]=new n(r))}i&&this.addInputs(i)}return f(t,[{key:"addInputs",value:function(t){var e=this;(t=p(t)).each(function(){var t=p(this);if(this.isContentEditable)t.data("as-isinput",!1);else{if(!t.is("input[type = text],textarea"))throw Error("AutoSuggest: Invalid input: only input[type = text], textarea and contenteditable elements are supported");t.data("as-isinput",!0)}}),t.on("input",function(){var t=p(this),n=t.val();if(t.data("as-isinput")){var o=s.getCursorPosition(this);e.activeElementCursorPosition=o,n=n.slice(0,o)}e.isActive=!1;var i=function(o){if(o.regex.test(n)){e.activeSuggestionList=o;var i=n.match(o.regex)[1];return o.getSuggestions(i,function(n){n.length?(e.isActive=!0,e.dropdown.fill(n,function(t){return e.setValue(t,o)}),e.dropdown.show(function(t){if(t.data("as-isinput")){var e=t.val(),n=s.getCursorPosition(t[0]),o=e.slice(0,n);p(".as-positionclone").remove();var i=p('<div class="as-positionclone"/>'),r=p('<div style="display:inline-block;">'+s.htmlEncode(o.slice(0,-1))+'<span id="as-positioner">'+s.htmlEncode(o.slice(-1))+"</span>"+s.htmlEncode(e.slice(n))+"</div>");i.append(r),s.cloneStyle(t[0],i[0]);var u=s.getGlobalOffset(t[0]);i.css({position:"absolute",opacity:0,left:u.left+"px",top:u.top+"px"}),p("body").append(i),t.is("input")?(i.css({overflowX:"auto",whiteSpace:"nowrap"}),i.scrollLeft(n===e.length?r.width():Math.min(s.getScrollLeftForInput(t[0]),r.width()))):(r.css("max-width","100%"),i.scrollLeft(t.scrollLeft()),i.scrollTop(t.scrollTop()));var a=s.getGlobalOffset(p("#as-positioner")[0]);return a.left+=10-i.scrollLeft(),a.top+=28-i.scrollTop(),i.remove(),a}}(t))):e.dropdown.hide()}),"break"}},r=!0,u=!1,a=void 0;try{for(var l,d=e.suggestionLists[Symbol.iterator]();!(r=(l=d.next()).done);r=!0){if("break"===i(l.value))break}}catch(t){u=!0,a=t}finally{try{!r&&d.return&&d.return()}finally{if(u)throw a}}e.isActive||e.dropdown.hide()}),t.keydown(function(t,n){if(e.isActive){var o=n||t;if(13===o.keyCode||9===o.keyCode)e.setValue(e.dropdown.getValue(),e.activeSuggestionList),e.dropdown.hide();else if(40==o.keyCode)e.dropdown.next();else{if(38!=o.keyCode)return!0;e.dropdown.prev()}o.preventDefault(),t.stopImmediatePropagation()}}),t.blur(function(){e.activeElement=null,e.isActive=!1,e.dropdown.hide()}).focus(function(){e.activeElement=p(this)})}},{key:"setValue",value:function(t,e){var n=this.activeElement,o=t.replaceWith;if(n&&n.data("as-isinput")){var i=n.val(),s=this.activeElementCursorPosition,r=i.slice(0,s),u=r.split(e.trigger||/\W/).pop(),a=(r=r.slice(0,0-u.length-(e.trigger||"").length)).length;n.val(r+o+i.slice(s)),n.focus();var l=t.cursorPosition,d=a+o.length;n[0].setSelectionRange(d+l[0],d+l[1])}this.isActive=!1}}]),t}();return p.fn.autoSuggest=function(t){return t instanceof h?(t.addInputs(this),t):new h(t,this)},h});
