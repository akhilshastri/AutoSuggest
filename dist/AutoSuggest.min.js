!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AutoSuggest=t()}(this,function(){"use strict";function e(e,t){return[].concat(e).map(function(e){var n=void 0===e?"undefined":o(e);return"string"===n?(e={show:e,replaceWith:e,cursorPosition:[0,0]},t||(e.on=[e.show])):"object"===n&&(s("Suggestion",e,["show","replaceWith"]),a("Suggestion",e,"show","string"),a("Suggestion",e,"replaceWith","string"),e.cursorPosition=e.cursorPosition||[0,0],e.cursorPosition.constructor!==Array&&(e.cursorPosition=[e.cursorPosition,e.cursorPosition]),t||(s("Suggestion",e,"on"),a("Suggestion",e,"on","string"),e.on=[].concat(e.on))),e})}function t(t){t&&!t.values&&(t={values:t}),s("SuggestionList",t,"values"),void 0===t.caseSensitive&&(t.caseSensitive=!0),"function"==typeof t.values?this.getSuggestions=function(n,o){t.values(n,function(t){return o(e(t,!0))})}:t.values.constructor!==Array&&"string"!=typeof t.values||(t.values=e(t.values),this.getSuggestions=function(e,n){var o=RegExp(e,t.caseSensitive?"":"i");n(t.values.filter(function(e){for(var t=!1,n=0;e.on.length>n&&!(t=o.test(e.on[n]));n++);return t}))});var n=t.trigger;if(n&&"string"!=typeof n)throw Error("AutoSuggest: Invalid Type, SuggestionList.trigger should be a string");if(n){var o="\\"+n.split("").join("\\");this.regex=RegExp("(?:^|[^"+o+"]+?)"+o+"(\\S*)$")}else this.regex=RegExp("(?:^|\\W+)(\\w+)$");this.trigger=n}function n(e){var t=e.startOffset,n=e.startContainer;if(n.nodeType!==n.TEXT_NODE)for(t=0,n=n.childNodes[e.startOffset];n&&n.nodeType!==n.TEXT_NODE;)n=n.firstChild;return{cursorPosition:t,containerTextNode:n}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;t.length>n;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function(e,t,n){[].concat(n).forEach(function(n){if(void 0===t[n])throw Error("AutoSuggest: Missing required parameter, "+e+"."+n)})},a=function(e,t,n,i){[].concat(t[n]).forEach(function(t){if((void 0===t?"undefined":o(t))!==i)throw Error("AutoSuggest: Invalid Type for "+e+"."+n+", expected "+i)})},l=function(e,t){var n=window.getComputedStyle(e);for(var o in n)n.hasOwnProperty(o)&&t.style.setProperty(o,n[o])},d=function(e){var t=e,n=0,o=0;do{o+=t.offsetLeft,n+=t.offsetTop}while(t=t.offsetParent);return{left:o,top:n}},u=function(e){if(e.createTextRange){var t=e.createTextRange(),n=window.getComputedStyle(e),o=parseFloat(n.paddingLeft),i=t.getBoundingClientRect();return e.getBoundingClientRect().left+e.clientLeft+o-i.left}return e.scrollLeft},c=function(e){var t=0;if(void 0!==e.selectionDirection)t="backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;else if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}return t},p=function(){var e=0,t=[];return function(n,o){for(t[o-e]=n;t[0];)++e,t.shift()()}},f=function(e,t,n){if(t="autosuggest_"+t,void 0===n)return void 0!==(n=e.dataset[t])?JSON.parse(e.dataset[t]):n;e.dataset[t]=JSON.stringify(n)},h=function(){function e(){i(this,e),this.width=0,this.isEmpty=!0,this.isActive=!1,this.dropdownContent=document.createElement("ul"),this.dropdownContent.className="dropdown-menu dropdown-menu-left",this.dropdown=document.createElement("div"),this.dropdown.className="dropdown open",this.dropdown.style.position="absolute",this.hide(),this.dropdown.appendChild(this.dropdownContent),document.body.appendChild(this.dropdown)}return r(e,[{key:"show",value:function(e){e&&(this.dropdown.style.left=e.left+"px",this.dropdown.style.top=e.top+"px",e.left+this.width>document.body.offsetWidth?(this.dropdownContent.classList.remove("dropdown-menu-left"),this.dropdownContent.classList.add("dropdown-menu-right")):(this.dropdownContent.classList.remove("dropdown-menu-right"),this.dropdownContent.classList.add("dropdown-menu-left")));var t=this.getActive();t&&t.classList.remove("active"),this.dropdownContent.firstElementChild.classList.add("active"),this.dropdown.style.display="block",this.isActive=!0}},{key:"hide",value:function(){this.dropdown.style.display="none",this.isActive=!1}},{key:"empty",value:function(){this.dropdownContent.innerHTML="",this.isEmpty=!0}},{key:"fill",value:function(e,t){var n=this;e.forEach(function(e){n.dropdownContent.innerHTML+="<li><a>"+e.show+"</a></li>";var o=n.dropdownContent.lastElementChild;f(o,"suggestion",e),o.addEventListener("mouseenter",function(){n.getActive().classList.remove("active"),o.classList.add("active")}),o.addEventListener("mousedown",function(o){t(e),n.hide(),o.preventDefault(),o.stopPropagation()})}),this.isActive?this.setWidth():(this.show(),this.setWidth(),this.hide()),this.isEmpty=!1}},{key:"setWidth",value:function(){this.width=this.dropdownContent.offsetWidth}},{key:"getActive",value:function(){for(var e=Array.prototype.slice.call(this.dropdownContent.querySelectorAll("li.active"),0);e[1];)e.pop().classList.remove("active");return e[0]}},{key:"getValue",value:function(e){return f(e||this.getActive(),"suggestion")}},{key:"selectNext",value:function(){var e=this.getActive(),t=e.nextElementSibling||this.dropdownContent.firstElementChild;return e.classList.remove("active"),t.classList.add("active"),this.getValue(t)}},{key:"selectPrev",value:function(){var e=this.getActive(),t=e.previousElementSibling||this.dropdownContent.lastElementChild;return e.classList.remove("active"),t.classList.add("active"),this.getValue(t)}}]),e}(),v=function(e){var t=e.element,o=e.trigger,i=e.cursorPosition,r=e.suggestion,s=r.replaceWith;if(f(t,"isInput")){var a=t.value,l=a.slice(0,i),d=l.split(o||/\W/).pop();l=l.slice(0,0-d.length-(o||"").length),t.value=l+s+a.slice(i),t.focus();var u=r.cursorPosition,c=l.length+s.length;t.setSelectionRange(c+u[0],c+u[1])}else{var p=window.getSelection().getRangeAt(0),h=n(p),v=h.cursorPosition,g=h.containerTextNode;if(!g)return null;var y=g.nodeValue,w=y.slice(0,v),m=w.split(o||/\W/).pop();w=w.slice(0,0-m.length-(o||"").length),g.nodeValue=w+s+y.slice(v);var S=r.cursorPosition,E=w.length+s.length,C=E+S[1];p.setStart(g,E+S[0]),p.setEnd(g,C)}};return function(){function e(o){if(i(this,e),!o)throw Error("AutoSuggest: Missing required parameter, options");this.inputs=[],this.dropdown=new h,this.suggestionLists=o.suggestions||[];for(var r=0;this.suggestionLists.length>r;r++){var s=this.suggestionLists[r];s instanceof t||(s.constructor!==Object&&(s={values:s}),!s.hasOwnProperty("caseSensitive")&&o.hasOwnProperty("caseSensitive")&&(s.caseSensitive=o.caseSensitive),this.suggestionLists[r]=new t(s))}var a=this,g=null,y=0,w=!1;this.onBlurHandler=function(){a.dropdown.hide()},this.onKeyDownHandler=function(e){if(w=!1,a.dropdown.isActive){var t=function(){e.preventDefault(),w=!0};if(13===e.keyCode||9===e.keyCode)return v({element:this,trigger:g.trigger,cursorPosition:y,suggestion:a.dropdown.getValue()}),a.dropdown.hide(),t();if(40===e.keyCode)return a.dropdown.selectNext(),t();if(38===e.keyCode)return a.dropdown.selectPrev(),t();if(27===e.keyCode)return a.dropdown.hide(),t()}},this.onKeyUpHandler=function(e){var t=this,o=window.getSelection();if(!w&&o.isCollapsed){var i=void 0;if(f(this,"isInput")){var r=c(this);i=this.value.slice(0,r),y=r}else{var s=n(o.getRangeAt(0)),h=s.cursorPosition,m=s.containerTextNode;if(!m)return;i=m.nodeValue.slice(0,h),y=h}var S=function(e,t){if(f(e,"isInput")){var o=e.value,i=o.slice(0,t),r=document.createElement("pre");r.id="autosuggest-positionclone";var s=document.createElement("span");s.appendChild(document.createTextNode(i.slice(-1))),r.appendChild(document.createTextNode(i.slice(0,-1))),r.appendChild(s),r.appendChild(document.createTextNode(o.slice(t))),l(e,r);var a=d(e);r.style.opacity=0,r.style.position="absolute",r.style.top=a.top+"px",r.style.left=a.left+"px",document.body.appendChild(r),"INPUT"===e.tagName?(r.style.overflowX="auto",r.style.whiteSpace="nowrap",r.scrollLeft=t===o.length?r.scrollWidth-r.clientWidth:Math.min(u(e),r.scrollWidth-r.clientWidth)):(r.style.maxWidth="100%",r.scrollTop=e.scrollTop,r.scrollLeft=e.scrollLeft);var c=d(s);return c.left+=10-r.scrollLeft,c.top+=28-r.scrollTop,document.body.removeChild(r),c}var p=window.getSelection().getRangeAt(0),h=n(p),v=h.cursorPosition,g=h.containerTextNode;if(!g)return null;var y=g.parentNode,w=g.nextSibling,m=g.nodeValue.slice(v);g.nodeValue=g.nodeValue.slice(0,v);var S=document.createElement("span");if(S.appendChild(document.createTextNode("\ufeff")),y.insertBefore(S,w),m){var E=document.createTextNode(m);y.insertBefore(E,w)}var C=d(S);return C.left+=10,C.top+=28,y.removeChild(S),y.normalize(),p.setStart(g,v),p.collapse(!0),C}(this,y);S&&function(){var e=0,n=!1,o=p();a.dropdown.empty();var r=function(r){r.regex.test(i)&&(n=!0,function(e){var n=i.match(r.regex)[1];r.getSuggestions(n,function(n){o(function(){a.dropdown.isEmpty&&(n.length?(g=r,a.dropdown.fill(n,function(e){v({element:t,trigger:r.trigger,cursorPosition:y,suggestion:e})}),a.dropdown.show(S)):a.dropdown.hide())},e)})}(e++))},s=!0,l=!1,d=void 0;try{for(var u,c=a.suggestionLists[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){r(u.value)}}catch(e){l=!0,d=e}finally{try{!s&&c.return&&c.return()}finally{if(l)throw d}}n||a.dropdown.hide()}()}};for(var m=arguments.length,S=Array(m>1?m-1:0),E=1;m>E;E++)S[E-1]=arguments[E];this.addInputs.apply(this,S)}return r(e,[{key:"addInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e})).forEach(function(t){if(t.isContentEditable)f(t,"isInput",!1);else{if("TEXTAREA"!==t.tagName&&("INPUT"!==t.tagName||"text"!==t.type))throw Error("AutoSuggest: Invalid input: only input[type = text], textarea and contenteditable elements are supported");f(t,"isInput",!0)}t.addEventListener("blur",e.onBlurHandler),t.addEventListener("keyup",e.onKeyUpHandler),t.addEventListener("keydown",e.onKeyDownHandler,!0),f(t,"index",e.inputs.push(t)-1)})}},{key:"removeInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e})).forEach(function(t){var n=f(t,"index");isNaN(n)||(e.inputs.splice(n,1),t.removeEventListener("blur",e.onBlurHandler),t.removeEventListener("keyup",e.onKeyUpHandler),t.removeEventListener("keydown",e.onKeyDownHandler,!0))})}},{key:"destroy",value:function(){this.removeInputs(this.inputs)}}]),e}()});
