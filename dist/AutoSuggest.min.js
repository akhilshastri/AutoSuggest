!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AutoSuggest=t()}(this,function(){"use strict";function e(e){return[].concat(e).map(function(e){var t=void 0===e?"undefined":r(e);if("string"===t)e={on:[e],show:e,insertText:e,focusText:[0,0]};else if("object"===t){try{d("Suggestion",e,"value"),u("Suggestion",e,"value","string")}catch(t){if(t instanceof TypeError)throw t;if(!e.on||!e.show||!e.insertText&&!e.insertHtml)try{d("Suggestion",e,["on","show","insertText"])}catch(n){throw e.on||e.show||e.insertText?n:t}u("Suggestion",e,"on","string"),u("Suggestion",e,"show","string"),u("Suggestion",e,"insertText","string"),u("Suggestion",e,"insertHtml","string")}e.show=e.show||e.value,e.insertText=e.insertText||e.value,e.on=[e.show].concat(e.on||e.value),e.focusText=e.focusText||[0,0],e.focusText.constructor!==Array&&(e.focusText=[e.focusText,e.focusText]),e.insertHtml&&(e.focusHtml=e.focusHtml||[0,0],e.focusHtml.constructor!==Array&&(e.focusHtml=[e.focusHtml,e.focusHtml]))}return e})}function t(t){t&&!t.values&&(t={values:t});try{d("SuggestionList",t,"trigger"),u("Suggestion",t,"trigger","string")}catch(e){if(e instanceof TypeError)throw e}if(d("SuggestionList",t,"values"),t.caseSensitive=!!t.caseSensitive,"function"==typeof t.values?this.getSuggestions=function(n,o){t.values(n,function(t){return o(e(t))})}:t.values.constructor!==Array&&"string"!=typeof t.values||(t.values=e(t.values),this.getSuggestions=function(e,n){var o=RegExp("^"+e,t.caseSensitive?"":"i");n(t.values.filter(function(t){for(var n=!1,r=0;t.on.length>r&&(t.on[r]===e||!(n=o.test(t.on[r])));r++);return n}))}),this.trigger=t.trigger,this.trigger){var n="\\"+this.trigger.split("").join("\\");this.regex=RegExp("(?:^|[^"+n+"]+?)"+n+"(\\S*)$")}else this.regex=RegExp("(?:^|\\W+)(\\w+)$")}function n(e,t,n){var o=e.slice(0,t),r=o.split(n||/\W/).pop(),i=r.length?o.slice(0,0-r.length):o;return r+=e.slice(t),{textAfterTrigger:r,textUptoTrigger:i}}function o(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return Math.max.apply(Math,l(t.map(function(e){return parseFloat(f(e,"line-height"))})))}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var n=0;t.length>n;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);e.length>t;t++)n[t]=e[t];return n}return Array.from(e)},d=function(e,t,n){[].concat(n).forEach(function(n){if(void 0===t[n])throw Error("AutoSuggest: Missing required parameter, "+e+"."+n)})},u=function(e,t,n,o){[].concat(t[n]).forEach(function(t){if((void 0===t?"undefined":r(t))!==o)throw new TypeError("AutoSuggest: Invalid Type for "+e+"."+n+", expected "+o)})},c=function(e,t){var n=window.getComputedStyle(e);for(var o in n)n.hasOwnProperty(o)&&t.style.setProperty(o,n[o])},f=function(e,t){return window.getComputedStyle(e).getPropertyValue(t)},p=function(e){var t=e,n=0,o=0;do{o+=t.offsetLeft,n+=t.offsetTop}while(t=t.offsetParent);return{left:o,top:n}},h=function(e){if(e.createTextRange){var t=e.createTextRange(),n=window.getComputedStyle(e),o=parseFloat(n.paddingLeft),r=t.getBoundingClientRect();return e.getBoundingClientRect().left+e.clientLeft+o-r.left}return e.scrollLeft},g=function(e){return[e.selectionStart,e.selectionEnd].sort(function(e,t){return e-t})},v=function(){var e=window.getSelection().getRangeAt(0),t=e.startContainer,n=e.startOffset;if(t.nodeType!==t.TEXT_NODE){for(t=t.childNodes[n];t&&t.nodeType!==t.TEXT_NODE;)t=t.firstChild;n=0}var o=e.endContainer,r=e.endOffset;if(o.nodeType!==o.TEXT_NODE){for(o=o.childNodes[r];o&&o.nodeType!==o.TEXT_NODE;)o=o.lastChild;r=o?o.nodeValue.length:o}return{startContainer:t,startOffset:n,endContainer:o,endOffset:r}},y=function(){var e=0,t=[];return function(n,o){for(t[o-e]=n;t[0];)++e,t.shift()()}},m=function(e,t,n){if(t="autosuggest_"+t,void 0===n)return void 0!==(n=e.dataset[t])?JSON.parse(e.dataset[t]):n;e.dataset[t]=JSON.stringify(n)};t.prototype.getMatch=function(e){return e.match(this.regex)[1]};var w=function(){function e(){i(this,e),this.width=0,this.isEmpty=!0,this.isActive=!1,this.dropdownContent=document.createElement("ul"),this.dropdownContent.className="dropdown-menu dropdown-menu-left",this.dropdown=document.createElement("div"),this.dropdown.className="dropdown open",this.dropdown.style.position="absolute",this.hide(),this.dropdown.appendChild(this.dropdownContent),document.body.appendChild(this.dropdown)}return s(e,[{key:"show",value:function(e){e&&(this.dropdown.style.left=e.left+"px",this.dropdown.style.top=e.top+"px",e.left+this.width>document.body.offsetWidth?(this.dropdownContent.classList.remove("dropdown-menu-left"),this.dropdownContent.classList.add("dropdown-menu-right")):(this.dropdownContent.classList.remove("dropdown-menu-right"),this.dropdownContent.classList.add("dropdown-menu-left"))),this.dropdown.style.display="block",this.isActive=!0}},{key:"hide",value:function(){this.dropdown.style.display="none",this.isActive=!1}},{key:"empty",value:function(){this.dropdownContent.innerHTML="",this.isEmpty=!0}},{key:"fill",value:function(e,t){var n=this;this.empty(),e.forEach(function(e){var o=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}("<li><a>"+e.show+"</a></li>");n.dropdownContent.append(o),m(o,"suggestion",e),o.addEventListener("mouseenter",function(){n.getActive().classList.remove("active"),o.classList.add("active")}),o.addEventListener("mousedown",function(o){t(e),n.hide(),o.preventDefault(),o.stopPropagation()})}),this.isActive||this.show(),this.width=this.dropdownContent.offsetWidth,this.isActive||this.hide(),this.setActive(),this.isEmpty=!1}},{key:"showLoader",value:function(e){this.empty(),this.dropdownContent.innerHTML='<div class="autosuggest-loader">Loading...</div>',this.show(e)}},{key:"getActive",value:function(){for(var e=Array.prototype.slice.call(this.dropdownContent.querySelectorAll("li.active"),0);e[1];)e.pop().classList.remove("active");return e[0]}},{key:"getValue",value:function(e){return m(e||this.getActive(),"suggestion")}},{key:"setActive",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.dropdownContent.firstElementChild,t=arguments[1];t&&t.classList.remove("active"),e.classList.add("active")}},{key:"selectNext",value:function(){var e=this.getActive();this.setActive(e.nextElementSibling||this.dropdownContent.firstElementChild,e)}},{key:"selectPrev",value:function(){var e=this.getActive();this.setActive(e.previousElementSibling||this.dropdownContent.lastElementChild,e)}}]),e}(),C="\ufeff",T=function(e){for(var t=e.nextSibling||e.parentNode.nextSibling;t.firstChild;)t=t.firstChild;return t},x=function(e){var t=e.element,n=e.trigger,o=e.suggestion,r=e.onChange;if(m(t,"isInput")){var i=g(t),s=a(i,2),d=s[1],u=t.value,c=u.slice(0,s[0]),f=c.split(n||/\W/).pop();c=c.slice(0,0-f.length-(n||"").length)+(o.insertText||o.insertHtml),t.value=c+u.slice(d),t.focus();var p=o.insertText?o.focusText:[0,0],h=c.length;t.setSelectionRange(h+p[0],h+p[1])}else{var y=v(),w=y.startContainer,C=y.startOffset,x=y.endContainer,S=y.endOffset,E=window.getSelection().getRangeAt(0),A=w.nodeValue.slice(0,C),L=A.split(n||/\W/).pop();if(A=A.slice(0,0-L.length-(n||"").length),w!==x?(w.nodeValue=A,function(e,t){if(e!==t)for(var n=T(e);n!==t;)n.parentNode.removeChild(n),n=T(e)}(w,x),x.nodeValue=x.nodeValue.slice(S),x.parentNode.normalize()):(w.splitText(S),w.nodeValue=A),o.insertHtml){var b=function e(t,n,o){var r=void 0,i=t;if(0!==i){do{r=n.pop(),console.log(r,i+=r.textContent.length)}while(n.length&&0>i);if(!r)throw new TypeError("AutoSuggest: Invalid value provided for Suggestion.focusHtml")}0===i?E[o+"After"](n[n.length-1]||w):r.nodeType===r.TEXT_NODE?E[o](r,i):e(i-r.textContent.length,Array.from(r.childNodes),o)},N=function(e,t){var n=document.createElement("div");n.innerHTML=t;for(var o=e.nextSibling,r=[];n.firstChild;)r.push(n.firstChild),e.parentNode.insertBefore(n.firstChild,o);return r}(w,o.insertHtml),H=N.length?o.focusHtml:[0,0];b(H[1],[].concat(l(N)),"setEnd"),b(H[0],[].concat(l(N)),"setStart")}else{w.nodeValue+=o.insertText;var k=o.focusText,O=w.nodeValue.length;w.parentNode.normalize(),E.setStart(w,O+k[0]),E.setEnd(w,O+k[1])}}r(t,o)};return function(){function e(r){if(i(this,e),!r)throw Error("AutoSuggest: Missing required parameter, options");this.inputs=[],this.dropdown=new w,this.onChange=r.onChange||Function.prototype,this.maxSuggestions=r.maxSuggestions||10,this.suggestionLists=r.suggestions||[];for(var s=0;this.suggestionLists.length>s;s++){var l=this.suggestionLists[s];l instanceof t||(l.constructor!==Object&&(l={values:l}),!l.hasOwnProperty("caseSensitive")&&r.hasOwnProperty("caseSensitive")&&(l.caseSensitive=r.caseSensitive),this.suggestionLists[s]=new t(l))}var d=this,u=null,T=!1;this.onBlurHandler=function(){d.dropdown.hide()},this.onKeyDownHandler=function(e){if(T=!1,d.dropdown.isActive){var t=function(){e.preventDefault(),T=!0};if(13===e.keyCode||9===e.keyCode)return x({element:this,trigger:u.trigger,suggestion:d.dropdown.getValue(),onChange:d.onChange}),d.dropdown.hide(),t();if(40===e.keyCode)return d.dropdown.selectNext(),t();if(38===e.keyCode)return d.dropdown.selectPrev(),t();if(27===e.keyCode)return d.dropdown.hide(),t()}};var S=0;this.onKeyUpHandler=function(){var e=this;if(!T){var t=void 0;if(m(this,"isInput")){var r=g(this),i=a(r,2),s=i[0];if(/[a-zA-Z_0-9]/.test(this.value.charAt(i[1])||" "))return void d.dropdown.hide();t=this.value.slice(0,s)}else{var l=v(),w=l.startContainer,E=l.startOffset,A=l.endContainer;if(!w||!A||/[a-zA-Z_0-9]/.test(A.nodeValue.charAt(l.endOffset)||" "))return void d.dropdown.hide();t=w.nodeValue.slice(0,E)}!function(){S++,d.dropdown.empty();var r=y(),i=0,s=void 0,l=!1,w=function(y){y.regex.test(t)&&(l=!0,function(i,l){var w=y.getMatch(t),T=function(e,t){if(m(e,"isInput")){var r=g(e),i=a(r,1)[0],s=n(e.value,i,t),l=s.textAfterTrigger,d=s.textUptoTrigger,u=document.createElement("pre");u.id="autosuggest-positionclone";var y=document.createElement("span");y.appendChild(document.createTextNode(C)),u.appendChild(document.createTextNode(d.replace(/ /g," "))),u.appendChild(y),u.appendChild(document.createTextNode(l.replace(/ /g," "))),c(e,u);var w=p(e);u.style.opacity=0,u.style.position="absolute",u.style.top=w.top+"px",u.style.left=w.left+"px",document.body.appendChild(u);var T=void 0;"INPUT"===e.tagName?(u.style.overflowX="auto",u.style.whiteSpace="nowrap",u.scrollLeft=i===e.value.length?u.scrollWidth-u.clientWidth:Math.min(h(e),u.scrollWidth-u.clientWidth),T=u.offsetHeight-parseFloat(f(u,"padding-top"))-parseFloat(f(u,"padding-bottom"))):(u.style.maxWidth="100%",u.style.whiteSpace="pre-wrap",u.scrollTop=e.scrollTop,u.scrollLeft=e.scrollLeft,T=o(u,y));var x=p(y);return x.left-=u.scrollLeft,x.top+=T-u.scrollTop,document.body.removeChild(u),x}var S=window.getSelection().getRangeAt(0),E=S.startContainer,A=S.startOffset,L=S.endContainer,b=S.endOffset,N=v(),H=N.startContainer,k=n(H.nodeValue,N.startOffset,t),O=k.textAfterTrigger,V=k.textUptoTrigger,I=H.parentNode,R=H.nextSibling,P=document.createElement("span");if(P.appendChild(document.createTextNode(C)),I.insertBefore(P,R),O){H.nodeValue=V;var M=document.createTextNode(O);I.insertBefore(M,R)}var W=p(P),D=o(P);W.top+=D,I.removeChild(P),O&&(I.removeChild(H.nextSibling),H.nodeValue=V+O);var U=window.getSelection().getRangeAt(0);return U.setStart(E,A),U.setEnd(L,b),W}(e,y.trigger);d.dropdown.isEmpty&&(s&&clearTimeout(s),s=setTimeout(function(){d.dropdown.showLoader(T)},0)),y.getSuggestions(w,function(t){l===S&&r(function(){s&&clearTimeout(s),d.dropdown.isEmpty&&(t.length?(u=y,d.dropdown.fill(t.slice(0,d.maxSuggestions),function(t){x({element:e,trigger:y.trigger,suggestion:t,onChange:d.onChange})}),d.dropdown.show(T)):d.dropdown.hide())},i)})}(i++,S))},T=!0,E=!1,A=void 0;try{for(var L,b=d.suggestionLists[Symbol.iterator]();!(T=(L=b.next()).done);T=!0){w(L.value)}}catch(e){E=!0,A=e}finally{try{!T&&b.return&&b.return()}finally{if(E)throw A}}l||d.dropdown.hide()}()}};for(var E=arguments.length,A=Array(E>1?E-1:0),L=1;E>L;L++)A[L-1]=arguments[L];this.addInputs.apply(this,A)}return s(e,[{key:"addInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e})).forEach(function(t){if(t.isContentEditable)m(t,"isInput",!1);else{if("TEXTAREA"!==t.tagName&&("INPUT"!==t.tagName||"text"!==t.type))throw Error("AutoSuggest: Invalid input: only input[type = text], textarea and contenteditable elements are supported");m(t,"isInput",!0)}t.addEventListener("blur",e.onBlurHandler),t.addEventListener("keyup",e.onKeyUpHandler),t.addEventListener("click",e.onKeyUpHandler),t.addEventListener("keydown",e.onKeyDownHandler,!0),m(t,"index",e.inputs.push(t)-1)})}},{key:"removeInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e})).forEach(function(t){var n=m(t,"index");isNaN(n)||(e.inputs.splice(n,1),t.removeEventListener("blur",e.onBlurHandler),t.removeEventListener("keyup",e.onKeyUpHandler),t.removeEventListener("click",e.onKeyUpHandler),t.removeEventListener("keydown",e.onKeyDownHandler,!0))})}},{key:"destroy",value:function(){this.removeInputs(this.inputs)}}]),e}()});
