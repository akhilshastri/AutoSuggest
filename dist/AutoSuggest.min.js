!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AutoSuggest=t()}(this,function(){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),o=function(t,n,e){[].concat(e).forEach(function(e){if(void 0===n[e])throw Error("AutoSuggest: Missing required parameter, "+t+"."+e)})},r=function(t,e,n,o){[].concat(e[n]).forEach(function(e){if((void 0===e?"undefined":i(e))!==o)throw new TypeError("AutoSuggest: Invalid Type for "+t+"."+n+", expected "+o)})},w=function(e,t){var n=window.getComputedStyle(e);for(var o in n)n.hasOwnProperty(o)&&t.style.setProperty(o,n[o])},m=function(e){for(var t=e,n=0,o=0;o+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent;);return{left:o,top:n}},S=function(e){if(e.createTextRange){var t=e.createTextRange(),n=window.getComputedStyle(e),o=parseFloat(n.paddingLeft),i=t.getBoundingClientRect();return e.getBoundingClientRect().left+e.clientLeft+o-i.left}return e.scrollLeft},E=function(e,t,n){if(t="autosuggest_"+t,void 0===n)return void 0!==(n=e.dataset[t])?JSON.parse(e.dataset[t]):n;e.dataset[t]=JSON.stringify(n)};function s(e){return[].concat(e).map(function(n){var e=void 0===n?"undefined":i(n);if("string"===e)n={on:[n],show:n,use:n,focus:[0,0]};else if("object"===e){try{o("Suggestion",n,"value"),r("Suggestion",n,"value","string")}catch(t){if(t instanceof TypeError)throw t;try{o("Suggestion",n,["on","show","use"])}catch(e){throw n.on||n.show||n.use?e:t}r("Suggestion",n,"on","string"),r("Suggestion",n,"use","string"),r("Suggestion",n,"show","string")}n.show=n.show||n.value,n.use=n.use||n.value,n.on=[n.show].concat(n.on||n.value),n.focus=n.focus||[0,0],n.focus.constructor!==Array&&(n.focus=[n.focus,n.focus])}return n})}function u(n){n&&!n.values&&(n={values:n});try{o("SuggestionList",n,"trigger"),r("Suggestion",n,"trigger","string")}catch(e){if(e instanceof TypeError)throw e}if(o("SuggestionList",n,"values"),n.caseSensitive=!!n.caseSensitive,"function"==typeof n.values?this.getSuggestions=function(e,t){n.values(e,function(e){return t(s(e))})}:n.values.constructor!==Array&&"string"!=typeof n.values||(n.values=s(n.values),this.getSuggestions=function(e,t){var o=RegExp("^"+e,n.caseSensitive?"":"i");t(n.values.filter(function(e){for(var t=!1,n=0;n<e.on.length&&!(t=o.test(e.on[n]));n++);return t}))}),this.trigger=n.trigger,this.trigger){var e="\\"+this.trigger.split("").join("\\");this.regex=RegExp("(?:^|[^"+e+"]+?)"+e+"(\\S*)$")}else this.regex=/(?:^|\W+)(\w+)$/}u.prototype.getMatch=function(e){return e.match(this.regex)[1]};var d=function(){function e(){l(this,e),this.width=0,this.isEmpty=!0,this.isActive=!1,this.dropdownContent=document.createElement("ul"),this.dropdownContent.className="dropdown-menu dropdown-menu-left",this.dropdown=document.createElement("div"),this.dropdown.className="dropdown open",this.dropdown.style.position="absolute",this.hide(),this.dropdown.appendChild(this.dropdownContent),document.body.appendChild(this.dropdown)}return t(e,[{key:"show",value:function(e){e&&(this.dropdown.style.left=e.left+"px",this.dropdown.style.top=e.top+"px",e.left+this.width>document.body.offsetWidth?(this.dropdownContent.classList.remove("dropdown-menu-left"),this.dropdownContent.classList.add("dropdown-menu-right")):(this.dropdownContent.classList.remove("dropdown-menu-right"),this.dropdownContent.classList.add("dropdown-menu-left")));var t=this.getActive();t&&t.classList.remove("active"),this.dropdownContent.firstElementChild.classList.add("active"),this.dropdown.style.display="block",this.isActive=!0}},{key:"hide",value:function(){this.dropdown.style.display="none",this.isActive=!1}},{key:"empty",value:function(){this.dropdownContent.innerHTML="",this.isEmpty=!0}},{key:"fill",value:function(e,n){var o=this;e.forEach(function(t){o.dropdownContent.innerHTML+="<li><a>"+t.show+"</a></li>";var e=o.dropdownContent.lastElementChild;E(e,"suggestion",t),e.addEventListener("mouseenter",function(){o.getActive().classList.remove("active"),e.classList.add("active")}),e.addEventListener("mousedown",function(e){n(t),o.hide(),e.preventDefault(),e.stopPropagation()})}),this.isActive?this.setWidth():(this.show(),this.setWidth(),this.hide()),this.isEmpty=!1}},{key:"setWidth",value:function(){this.width=this.dropdownContent.offsetWidth}},{key:"getActive",value:function(){for(var e=Array.prototype.slice.call(this.dropdownContent.querySelectorAll("li.active"),0);e[1];)e.pop().classList.remove("active");return e[0]}},{key:"getValue",value:function(e){return E(e||this.getActive(),"suggestion")}},{key:"selectNext",value:function(){var e=this.getActive(),t=e.nextElementSibling||this.dropdownContent.firstElementChild;return e.classList.remove("active"),t.classList.add("active"),this.getValue(t)}},{key:"selectPrev",value:function(){var e=this.getActive(),t=e.previousElementSibling||this.dropdownContent.lastElementChild;return e.classList.remove("active"),t.classList.add("active"),this.getValue(t)}}]),e}();function C(e){var t=e.startOffset,n=e.startContainer;if(n.nodeType!==n.TEXT_NODE)for(t=0,n=n.childNodes[e.startOffset];n&&n.nodeType!==n.TEXT_NODE;)n=n.firstChild;return{cursorPosition:t,containerTextNode:n}}var y=function(e){var t=e.element,n=e.trigger,o=e.cursorPosition,i=e.suggestion,r=i.use;if(E(t,"isInput")){var s=t.value,a=s.slice(0,o),l=a.split(n||/\W/).pop();a=a.slice(0,0-l.length-(n||"").length),t.value=a+r+s.slice(o),t.focus();var u=i.focus,d=a.length+r.length;t.setSelectionRange(d+u[0],d+u[1])}else{var c=window.getSelection().getRangeAt(0),p=C(c),f=p.cursorPosition,h=p.containerTextNode;if(!h)return null;var g=h.nodeValue,v=g.slice(0,f),y=v.split(n||/\W/).pop();v=v.slice(0,0-y.length-(n||"").length),h.nodeValue=v+r+g.slice(f);var w=i.focus,m=v.length+r.length,S=m+w[1];c.setStart(h,m+w[0]),c.setEnd(h,S)}};return function(){function a(e){if(l(this,a),!e)throw Error("AutoSuggest: Missing required parameter, options");this.inputs=[],this.dropdown=new d,this.suggestionLists=e.suggestions||[];for(var t=0;t<this.suggestionLists.length;t++){var n=this.suggestionLists[t];n instanceof u||(n.constructor!==Object&&(n={values:n}),!n.hasOwnProperty("caseSensitive")&&e.hasOwnProperty("caseSensitive")&&(n.caseSensitive=e.caseSensitive),this.suggestionLists[t]=new u(n))}var h=this,g=null,v=0,s=!1;this.onBlurHandler=function(){h.dropdown.hide()},this.onKeyDownHandler=function(e){if(s=!1,h.dropdown.isActive){var t=function(){e.preventDefault(),s=!0};if(13===e.keyCode||9===e.keyCode)return y({element:this,trigger:g.trigger,cursorPosition:v,suggestion:h.dropdown.getValue()}),h.dropdown.hide(),t();if(40===e.keyCode)return h.dropdown.selectNext(),t();if(38===e.keyCode)return h.dropdown.selectPrev(),t();if(27===e.keyCode)return h.dropdown.hide(),t()}},this.onKeyUpHandler=function(e){var c=this,t=window.getSelection();if(!s&&t.isCollapsed){var p=void 0;if(E(this,"isInput")){var n=function(e){var t=0;if(void 0!==e.selectionDirection)t="backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;else if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}return t}(this);p=this.value.slice(0,n),v=n}else{var o=C(t.getRangeAt(0)),i=o.cursorPosition,r=o.containerTextNode;if(!r)return;p=r.nodeValue.slice(0,i),v=i}var f=function(e,t){if(E(e,"isInput")){var n=e.value,o=n.slice(0,t),i=document.createElement("pre");i.id="autosuggest-positionclone";var r=document.createElement("span");r.appendChild(document.createTextNode(o.slice(-1))),i.appendChild(document.createTextNode(o.slice(0,-1))),i.appendChild(r),i.appendChild(document.createTextNode(n.slice(t))),w(e,i);var s=m(e);i.style.opacity=0,i.style.position="absolute",i.style.top=s.top+"px",i.style.left=s.left+"px",document.body.appendChild(i),i.scrollLeft="INPUT"===e.tagName?(i.style.overflowX="auto",i.style.whiteSpace="nowrap",t===n.length?i.scrollWidth-i.clientWidth:Math.min(S(e),i.scrollWidth-i.clientWidth)):(i.style.maxWidth="100%",i.style.whiteSpace="pre-wrap",i.scrollTop=e.scrollTop,e.scrollLeft);var a=m(r);return a.left+=10-i.scrollLeft,a.top+=28-i.scrollTop,document.body.removeChild(i),a}var l=window.getSelection().getRangeAt(0),u=C(l),d=u.cursorPosition,c=u.containerTextNode;if(!c)return null;var p=c.parentNode,f=c.nextSibling,h=c.nodeValue.slice(d);c.nodeValue=c.nodeValue.slice(0,d);var g=document.createElement("span");if(g.appendChild(document.createTextNode("\ufeff")),p.insertBefore(g,f),h){var v=document.createTextNode(h);p.insertBefore(v,f)}var y=m(g);return y.left+=10,y.top+=28,p.removeChild(g),p.normalize(),l.setStart(c,d),l.collapse(!0),y}(this,v);f&&function(){var n,o,i=0,r=!1,s=(n=0,o=[],function(e,t){for(o[t-n]=e;o[0];)++n,o.shift()()});h.dropdown.empty();var e=function(t){var n,e;t.regex.test(p)&&(r=!0,n=i++,e=t.getMatch(p),t.getSuggestions(e,function(e){s(function(){h.dropdown.isEmpty&&(e.length?(g=t,h.dropdown.fill(e,function(e){y({element:c,trigger:t.trigger,cursorPosition:v,suggestion:e})}),h.dropdown.show(f)):h.dropdown.hide())},n)}))},t=!0,a=!1,l=void 0;try{for(var u,d=h.suggestionLists[Symbol.iterator]();!(t=(u=d.next()).done);t=!0){e(u.value)}}catch(e){a=!0,l=e}finally{try{!t&&d.return&&d.return()}finally{if(a)throw l}}r||h.dropdown.hide()}()}};for(var o=arguments.length,i=Array(1<o?o-1:0),r=1;r<o;r++)i[r-1]=arguments[r];this.addInputs.apply(this,i)}return t(a,[{key:"addInputs",value:function(){for(var t=this,e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e})).forEach(function(e){if(e.isContentEditable)E(e,"isInput",!1);else{if("TEXTAREA"!==e.tagName&&("INPUT"!==e.tagName||"text"!==e.type))throw Error("AutoSuggest: Invalid input: only input[type = text], textarea and contenteditable elements are supported");E(e,"isInput",!0)}e.addEventListener("blur",t.onBlurHandler),e.addEventListener("keyup",t.onKeyUpHandler),e.addEventListener("keydown",t.onKeyDownHandler,!0),E(e,"index",t.inputs.push(e)-1)})}},{key:"removeInputs",value:function(){for(var n=this,e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];Array.prototype.concat.apply([],t.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e})).forEach(function(e){var t=E(e,"index");isNaN(t)||(n.inputs.splice(t,1),e.removeEventListener("blur",n.onBlurHandler),e.removeEventListener("keyup",n.onKeyUpHandler),e.removeEventListener("keydown",n.onKeyDownHandler,!0))})}},{key:"destroy",value:function(){this.removeInputs(this.inputs)}}]),a}()});
